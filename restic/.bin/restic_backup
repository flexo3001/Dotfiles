#!/bin/bash

source $HOME/.bin/restic_common

restic -r $RESTIC_REPOSITORY unlock

info "Starting backup"
restic --cache-dir $CACHE_DIR -r $RESTIC_REPOSITORY backup $BACKUP_PATHS $BACKUP_EXCLUDES

info "Forgetting snapshots"
restic --cache-dir $CACHE_DIR -r $RESTIC_REPOSITORY forget --keep-hourly $KEEP_HOURS --keep-daily $KEEP_DAYS --keep-weekly $KEEP_WEEKS --keep-monthly $KEEP_WEEKS --keep-yearly $KEEP_YEARS

info "Pruning snapshots"
restic --cache-dir $CACHE_DIR -r $RESTIC_REPOSITORY prune